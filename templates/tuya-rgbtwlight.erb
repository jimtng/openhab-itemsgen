Thing mqtt:topic:mosquitto:<%= thingid %> (mqtt:broker:mosquitto) {
    Channels:
        Type switch : power	 [ stateTopic="tuya/<%= thingid %>/state", commandTopic="tuya/<%= thingid %>/command" ]
        Type dimmer : dimmer     [ stateTopic="tuya/<%= thingid %>/white_brightness_state", commandTopic="tuya/<%= thingid %>/white_brightness_command" ]
        Type dimmer : ct         [ stateTopic="tuya/<%= thingid %>/color_temp_state", commandTopic="tuya/<%= thingid %>/color_temp_command", min=154, max=400, step=1 ]
        Type string : color      [ stateTopic="stat/<%= thingid %>/RESULT", transformationPattern="REGEX:(.*Color.*)âˆ©JSONPATH:$.Color", commandTopic="cmnd/<%= thingid %>/Color" ]
        Type colorHSB : colorhsb [ stateTopic="tuya/<%= thingid %>/hsb_state", commandTopic="tuya/<%= thingid %>/hsb_command" ]
        Type contact: availability [ stateTopic="tuya/<%= thingid %>/status", on="online", off="offline" ]
}

<%

# Return the assistant tags or empty string based on "assistant_tags" value from yaml
def assistant_tags(str)
  omit_assistant_tags ? '' : str
end

%>
// Template: <%= template_name %>

Group <%= name %> "<%= label %>" <light> <%= make_groups groups %> <%= make_tags 'Lightbulb', tags %>  <%= make_metadata assistant_tags(%w[ga="Light" alexa="Endpoint.Light"]), metadata %>

Switch <%= name %>_Power  "<%= label %> Power" <light> <%= make_groups name, power['groups'] %> <%= make_tags %w[Control Power], power['tags'] %> { channel="mqtt:topic:mosquitto:<%= thingid %>:power", autoupdate="false"<%= add_metadata assistant_tags(%[ga="lightPower" alexa="Powercontroller.powerState"]), power['metadata'] %> }
Dimmer <%= name %>_Dimmer "<%= label %>" <%= make_groups name, dimmer['groups'] %> <%= make_tags %w[Control Light], dimmer['tags'] %> { channel="mqtt:topic:mosquitto:<%= thingid %>:dimmer"<%= add_metadata assistant_tags(%[ga="lightBrightness" alexa="BrightnessController.brightness"]), dimmer['metadata'] %> }
<% if key? 'ct' %>
Dimmer <%= name %>_CT     "<%= label %> CT" <%= make_groups name, ct['groups'] %> <%= make_tags %w[Control ColorTemperature], ct['tags'] %> { channel="mqtt:topic:mosquitto:<%= thingid %>:ct"<%= add_metadata assistant_tags(%{ga="lightColorTemperature" alexa="ColorTemperatureController.colorTemperatureInKelvin" [increment="10"]}), ct['metadata'] %> }
<% end %>
<% if key? 'color' %>
Color <%= name %>_Color  "<%= label %> Color" <colorwheel> <%= make_groups name, color['groups'] %> <%= make_tags %w[Control Color], color['tags'] %>  { channel="mqtt:topic:mosquitto:<%= thingid %>:colorhsb"<%= add_metadata assistant_tags(%{ga="lightColor" alexa="ColorController.color"}), color['metadata'] %> }
<% end %>
Number <%= name %>_RSSI   "<%= label %> RSSI [%d%%]" <network> <%= make_groups name, 'gSignalStrength' %>  { channel="mqtt:topic:mosquitto:<%= thingid %>:rssi" }
String <%= name %>_State <%= make_groups name, 'gTasmotaState' %>     { channel="mqtt:topic:mosquitto:<%= thingid %>:state", id="<%= thingid %>" }
String <%= name %>_IPAddress <%= make_groups name, 'gTasmotaIPs' %>     { channel="mqtt:topic:mosquitto:<%= thingid %>:ipaddress", autoupdate="false" }
Contact <%= name %>_Availability "<%= label %> Availability [MAP(availability.map):%s]" <%= make_groups name, 'gAvailability' %> { channel="mqtt:topic:mosquitto:<%= thingid %>:availability" }




Group <%= name %> "<%= label %>" <light> <%= make_groups groups %> <%= make_tags 'Lightbulb', tags %> {  }
Switch <%= name %>_Power  "<%= label %> Power" <light> <%= groups|groups %><%= tags|tags %> { channel="mqtt:topic:mosquitto:<%= thingid %>:power", autoupdate="false"<%= metadata_power|metadata %> }
Dimmer <%= name %>_Dimmer "<%= label %>" { channel="mqtt:topic:mosquitto:<%= thingid %>:dimmer"<%=  metadata|metadata  %><%= metadata_dimmer|metadata %> }
Dimmer <%= name %>_CT     "<%= label %> CT"            { channel="mqtt:topic:mosquitto:<%= thingid %>:ct" }
String <%= name %>_Color  "<%= label %> Color"  { channel="mqtt:topic:mosquitto:<%= thingid %>:colorhsb" }
Contact <%= name %>_Availability "<%= label %> Availability [MAP(availability.map):%s]" (gAvailability) { channel="mqtt:topic:mosquitto:<%= thingid %>:availability" }
